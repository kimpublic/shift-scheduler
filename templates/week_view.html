{{define "week_view"}}
<style>
  .week-grid {
    display: grid;
    grid-template-columns: 80px repeat(10, 1fr); /* 80px=요일, 10시간=컬럼 */
    border: 1px solid #ccc;
    user-select: none;
  }
  .time-col {
    border-left: 1px solid #eee;
    position: relative;
  }
  .time-col::after {
    content: "";
    position: absolute;
    top: 0; bottom: 0; left: 0;
    width: 100%;
    background-image: repeating-linear-gradient(
      to bottom,
      transparent,
      transparent 10px,
      rgba(0,0,0,0.05) 10px,
      rgba(0,0,0,0.05) 11px
    );
    pointer-events: none;
  }
  .day-row {
    display: contents; /* grid children will span columns */
  }
  .day-label {
    border-bottom: 1px solid #ccc;
    padding: 4px;
    background: #f9f9f9;
  }
  .cell {
    border-bottom: 1px solid #eee;
    height: 60px; /* 한 시간 60px → 10분=10px */
    position: relative;
  }
  .cell.selected {
    background: rgba(0, 120, 255, 0.2);
  }
</style>

<div class="week-grid" id="week-grid-inner">
  <!-- header row -->
  <div></div>
  {{range $h := .Hours}}
    <div class="time-col">{{$h}}:00</div>
  {{end}}

  <!-- day rows -->
  {{range $day := .Days}}
    <div class="day-label">{{$day}}</div>
    {{range $h := $.Hours}}
      <div class="cell" 
           data-day="{{$day}}" 
           data-hour="{{$h}}"></div>
    {{end}}
  {{end}}
</div>

<script>
(function(){
  const grid = document.getElementById("week-grid-inner");
  let isDown = false, startCell = null;

  grid.addEventListener("mousedown", e => {
    if(e.target.classList.contains("cell")) {
      isDown = true;
      startCell = e.target;
      e.target.classList.add("selected");
    }
  });
  grid.addEventListener("mouseover", e => {
    if(isDown && e.target.classList.contains("cell")) {
      e.target.classList.add("selected");
    }
  });
  window.addEventListener("mouseup", () => {
    if(isDown && startCell) {
      // 선택된 셀들 정보 수집
      const selected = [...grid.querySelectorAll(".cell.selected")];
      const day = startCell.dataset.day;
      const hours = selected.map(c => parseInt(c.dataset.hour));
      const minH = Math.min(...hours), maxH = Math.max(...hours)+1;
      // HTMX로 서버에 전송
      htmx.ajax('POST', '/schedule/select', {
        target: '#week-grid',
        swap: 'outerHTML',
        values: { day: day, start: minH, end: maxH }
      });
    }
    isDown = false;
    startCell = null;
    // reset selection UI
    [...grid.querySelectorAll(".cell")].forEach(c => c.classList.remove("selected"));
  });
})();
</script>
{{end}}
